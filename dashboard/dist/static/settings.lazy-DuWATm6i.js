import{J as e,aL as W,aM as R,aN as M,W as B,aO as H,aP as D,aQ as V,aR as $,aS as U,aT as G,aU as J,aV as X,aW as Y,aX as Z,aY as ee,aZ as se,a_ as te,a$ as ae,b0 as ne,F as O,b1 as re,H as z,I as l,ay as ie,b2 as le,b3 as L,b4 as ce,b5 as S,b6 as w,b7 as oe,b8 as de,b9 as f,ba as ue,bb as pe,bc as p,bd as x,be as m,bf as b,bg as xe,bh as me,bi as he,bj as ge,bk as d,bl as je,bm as fe,ai as k,bn as be,V as N,bo as h,ag as ye,ah as Se,bp as Q,aj as Ne,bq as ve,br as ke,bs as Ce,bt as Fe,bu as _e,bv as De,r as T,bw as we,bx as Te,by as I,bz as Ie,$ as Ae,bA as ze,bB as Ee,bC as Pe,bD as q,au as A,bE as Ke,K as Le,a7 as Me,bF as Oe}from"./index-DPGZIZMG.js";import{P as Qe}from"./index-DWVRUEcY.js";import{S as qe}from"./index-B9CT5ENx.js";function We(s,t,a){const n={...s};return t.top+s.y<=a.top?n.y=a.top-t.top:t.bottom+s.y>=a.top+a.height&&(n.y=a.top+a.height-t.bottom),t.left+s.x<=a.left?n.x=a.left-t.left:t.right+s.x>=a.left+a.width&&(n.x=a.left+a.width-t.right),n}const Re=s=>{let{containerNodeRect:t,draggingNodeRect:a,transform:n}=s;return!a||!t?n:We(n,a,t)},Be=s=>{let{transform:t}=s;return{...t,x:0}},He={sideEffects:R({styles:{active:{opacity:"0.4"}}})};function Ve({activeId:s,dropAnimation:t=He,children:a,...n}){return e.jsx(W,{dropAnimation:t,...n,children:s?e.jsx(M,{value:s,asChild:!0,children:a}):null})}function $e({value:s,onValueChange:t,collisionDetection:a=$,modifiers:n=[Be,Re],strategy:r=G,onMove:u,children:c,overlay:y,...g}){const[C,j]=B.useState(null),F=H(D(Z),D(Y),D(X));return e.jsxs(V,{modifiers:n,sensors:F,onDragStart:({active:i})=>j(i.id),onDragEnd:({active:i,over:o})=>{if(o&&i.id!==(o==null?void 0:o.id)){const P=s.findIndex(_=>_.id===i.id),K=s.findIndex(_=>_.id===o.id);u?u({activeIndex:P,overIndex:K}):t==null||t(J(s,P,K))}j(null)},onDragCancel:()=>j(null),collisionDetection:a,...g,children:[e.jsx(U,{items:s,strategy:r,children:c}),y?e.jsx(Ve,{activeId:C,children:y}):null]})}const Ue=({footer:s,content:t,children:a,title:n})=>e.jsxs(ee,{children:[e.jsx(se,{className:"p-4",children:e.jsx(te,{className:"flex flex-row justify-start items-center gap-3 text-lg",children:n})}),e.jsx(ae,{className:"p-4",children:t||a}),s&&e.jsxs(ne,{children:[" ",s," "]})]});async function Ge(){return z("/nodes/settings").then(s=>s.certificate)}const Je="settings",Xe=()=>O({queryKey:[re,Je],queryFn:Ge,initialData:""}),Ye=()=>{const{t:s}=l(),{data:t}=Xe();return e.jsx(ie,{text:t,successMessage:s("page.settings.certificate.copied"),copyIcon:le,copyLabel:s("page.settings.certificate.copy"),errorLabel:s("page.settings.certificate.error")})},Ze=()=>{const{t:s}=l();return e.jsx(Ue,{title:s("certificate"),children:e.jsx(Ye,{})})},es=L({rules:oe(L({pattern:S(),result:de(["xray","sing-box","clash","clash-meta","block","links","base64-links","template"])})),shuffle_configs:w(),placeholder_if_disabled:w(),placeholder_remark:S(),template_on_acceptance:w().default(!1),profile_title:S().default(""),support_link:S().default(""),update_interval:ce.number().int().default(0)}),ss=({index:s,field:t,onRemove:a})=>{const n=f(),[r,u]=ue(!1);return e.jsxs(e.Fragment,{children:[e.jsx(pe,{open:r,onOpenChange:u,action:()=>a(s)}),e.jsx(M,{value:t.id,asChild:!0,children:e.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-2",children:[e.jsx(p,{control:n.control,name:`rules.${s}.pattern`,render:({field:c})=>e.jsx(x,{children:e.jsx(m,{children:e.jsx("div",{children:e.jsx(b,{className:"h-8",...c})})})})}),e.jsx(p,{control:n.control,name:`rules.${s}.result`,render:({field:c})=>e.jsx(x,{children:e.jsxs(xe,{onValueChange:c.onChange,defaultValue:c.value,children:[e.jsx(m,{children:e.jsx("div",{children:e.jsx(me,{className:"h-8 p-2",children:e.jsx(he,{})})})}),e.jsxs(ge,{children:[e.jsx(d,{value:"xray",children:"xray"}),e.jsx(d,{value:"sing-box",children:"sing-box"}),e.jsx(d,{value:"clash",children:"clash"}),e.jsx(d,{value:"clash-meta",children:"clash-meta"}),e.jsx(d,{value:"block",children:"block"}),e.jsx(d,{value:"template",children:"template"}),e.jsx(d,{value:"base64-links",children:"base64-links"}),e.jsx(d,{value:"links",children:"links"})]})]})})}),e.jsx(je,{variant:"outline",size:"icon",className:"size-8 shrink-0",children:e.jsx(fe,{className:"size-4","aria-hidden":"true"})}),e.jsxs(k,{type:"button",variant:"outline",size:"icon",className:"size-8 shrink-0",onClick:()=>u(!0),children:[e.jsx(be,{className:"size-4 text-destructive","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Remove"})]})]})},t.id)]})},v=()=>e.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-0 ",children:[e.jsx(N,{className:"h-8 w-full rounded-sm"}),e.jsx(N,{className:"h-8 w-full rounded-sm"}),e.jsx(N,{className:"size-8 shrink-0 rounded-sm"}),e.jsx(N,{className:"size-8 shrink-0 rounded-sm"})]}),ts=()=>{const{t:s}=l(),t=f();return e.jsx(p,{control:t.control,name:"profile_title",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:s("page.settings.subscription-settings.profile-title")}),e.jsx(m,{children:e.jsx(b,{className:"h-8",...a})})]})})},as=()=>{const{t:s}=l(),t=f();return e.jsx(p,{control:t.control,name:"support_link",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:s("page.settings.subscription-settings.support-link")}),e.jsx(m,{children:e.jsx(b,{className:"h-8",...a})})]})})},ns=()=>{const{t:s}=l(),t=f();return e.jsx(p,{control:t.control,name:"update_interval",render:({field:a})=>e.jsxs(x,{children:[e.jsx(h,{children:s("page.settings.subscription-settings.update-interval")}),e.jsx(m,{children:e.jsx(b,{className:"h-8",type:"number",...a,...t.register("update_interval",{valueAsNumber:!0})})})]})})},rs=()=>{const{t:s}=l(),t=f();return e.jsx(p,{control:t.control,name:"placeholder_remark",render:({field:a})=>e.jsxs(x,{children:[e.jsxs(h,{className:"flex flex-row items-center gap-2",children:[s("page.settings.subscription-settings.placeholder-remark"),e.jsxs(ye,{children:[e.jsx(Se,{children:e.jsx(Q,{className:"size-5"})}),e.jsx(Ne,{className:"w-80",children:e.jsx(ve,{})})]})]}),e.jsx(m,{children:e.jsx(b,{className:"h-8",...a})})]})})},is=()=>{const{t:s}=l();return e.jsxs(ke,{children:[e.jsx(Q,{className:"mr-2"}),e.jsx(Ce,{className:"font-semibold text-primary",children:s("page.settings.subscription-settings.alert.title")}),e.jsx(Fe,{children:s("page.settings.subscription-settings.alert.desc")})]})};function ls(){const{t:s}=l(),{data:t,isFetching:a}=os(),n=xs(),r=_e({resolver:De(es),defaultValues:t}),u=T.useCallback(()=>{r.reset(t)},[r,t]),c=T.useCallback(()=>{r.reset(t,{keepDirtyValues:!0})},[r,t]);T.useEffect(()=>{t&&c()},[t,c]);const y=i=>{n.mutate(i)},{fields:g,append:C,move:j,remove:F}=we({control:r.control,name:"rules"});return e.jsx(Te,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(y),className:"flex w-full max-w-4xl flex-col gap-2",children:[e.jsx(ts,{}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-2 flex flex-col",children:[e.jsx(ns,{}),e.jsx(as,{})]}),e.jsx(I,{name:"template_on_acceptance",label:s("page.settings.subscription-settings.template-on-acceptance")}),e.jsx(rs,{}),e.jsx(I,{name:"placeholder_if_disabled",label:s("page.settings.subscription-settings.placeholder-if-disabled")}),e.jsx(I,{name:"shuffle_configs",label:s("page.settings.subscription-settings.shuffle-configs")}),e.jsx(Ie,{className:"my-3"}),e.jsx("h4",{className:"text-lg mt-2",children:s("page.settings.subscription-settings.subscription-title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("page.settings.subscription-settings.subscription-desc")}),e.jsx(Ae,{isFetching:a,Skeleton:e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx(v,{}),e.jsx(v,{}),e.jsx(v,{})]}),isNotFound:g.length===0,NotFound:e.jsx(is,{}),Component:e.jsx("div",{className:"space-y-1",children:e.jsxs($e,{value:g,onMove:({activeIndex:i,overIndex:o})=>j(i,o),children:[e.jsxs("div",{className:"grid grid-cols-[2fr,1.3fr,0.25fr,0.25fr] items-center justify-start gap-2 my-2",children:[e.jsx(h,{children:s("pattern")}),e.jsx(h,{children:s("result")})]}),e.jsx(ze,{className:"flex flex-col w-full max-h-[400px] gap-2",type:"always",children:g.map((i,o)=>e.jsx(ss,{field:i,index:o,onRemove:F}))})]})})}),e.jsxs(Ee,{className:"w-full flex-end",children:[e.jsx(k,{type:"button",variant:"destructive",className:"w-fit",onMouseDown:u,children:s("page.settings.subscription-settings.reset-local-changes")}),e.jsx(k,{type:"button",variant:"outline",className:"w-fit",onClick:()=>C({pattern:"",result:"block"}),children:s("page.settings.subscription-settings.add-rule")}),e.jsx(k,{type:"submit",className:"w-fit",children:s("submit")})]})]})})}async function cs(){return z("/system/settings/subscription")}const E=["system","settings","subscription"],os=()=>O({queryKey:E,queryFn:cs,initialData:{template_on_acceptance:!1,profile_title:"",support_link:"",update_interval:0,rules:[]}});async function ds(s){return z("/system/settings/subscription",{method:"put",body:s}).then(t=>t)}const us=()=>{q.error(A.t("events.update.error"))},ps=()=>{q.success(A.t("events.update.success.title",{name:"Subscription Settings"}),{description:A.t("events.update.success.desc")}),Ke.invalidateQueries({queryKey:E})},xs=()=>Pe({mutationKey:E,mutationFn:ds,onError:us,onSuccess:ps}),ms=()=>{const{t:s}=l();return e.jsx(Le,{title:s("page.settings.subscription-settings.title"),description:s("page.settings.subscription-settings.description"),content:e.jsx(ls,{})})},hs=()=>{const{t:s}=l();return e.jsx(Qe,{title:s("settings"),className:"sm:flex flex-col lg:grid grid-cols-2 gap-3 h-full",children:e.jsxs(Oe,{className:"gap-3",children:[e.jsx(ms,{}),e.jsx(Ze,{})]})})},bs=Me("/_dashboard/settings")({component:()=>e.jsxs(qe,{children:[" ",e.jsx(hs,{})," "]})});export{bs as Route,hs as Settings};
