import{J as e,aY as _,a$ as G,ac as k,ag as Q,ah as J,ai as y,aj as Y,bL as U,af as W,ae as A,I as b,bM as X,bN as Z,bO as K,bP as q,bQ as ee,bR as se,bA as te,bS as ae,bT as ne,bU as ie,bV as oe,bW as le,bX as re,F as ce,bY as de,r as m,bZ as ue,b_ as xe,bB as be,b$ as he,c0 as me,c1 as je,c2 as ge,c3 as P,c4 as pe,c5 as fe,c6 as Se,at as S,au as C,c7 as Ce,c8 as ye,c9 as Te,ca as ve,cb as Ne,cc as De,cd as Ee,ce as Ie,aF as we,cf as Pe,cg as ze,aC as ke,ba as Ae,H as Fe,a7 as He,aJ as Be,aK as Re}from"./index-DPGZIZMG.js";import{P as Ve}from"./index-DWVRUEcY.js";import{N as $e,D as Oe}from"./actions-cell-DuCDMYMS.js";import{S as Le}from"./index-B9CT5ENx.js";const Me=({header:s,content:t,entity:a,checked:n=!1})=>e.jsx(_,{className:"w-full h-30 m-[4px]",children:e.jsxs(G,{className:k("p-2 flex-col flex gap-2 justify-start",n&&"dark:bg-primary-foreground bg-secondary"),children:[e.jsx(s,{entity:a}),e.jsx(t,{entity:a})]})}),_e=({buttonChild:s})=>e.jsxs(Q,{children:[e.jsx(J,{asChild:!0,children:e.jsx(y,{size:"sm",variant:"outline",className:"mr-1 lg:flex",children:s})}),e.jsx(Y,{className:"w-80 p-0",children:e.jsx(F,{})})]}),F=()=>{const{sidebarEntityId:s,sidebarEntities:t,setSidebarEntityId:a,sidebarCardProps:n}=U(),{table:i}=W(),r=A("md"),c=i.getState().pagination.pageSize<=10&&r?"max-h-[45rem]":"max-h-[20rem]",{t:l}=b();return e.jsxs(X,{className:"w-full",children:[e.jsx(Z,{children:e.jsx(K,{children:e.jsxs(q,{className:"hstack justify-between items-center",children:[l("inbounds"),e.jsx(y,{variant:"ghost",size:"sm",className:"p-1",onMouseDown:()=>a(void 0),children:l("deselect")})]})})}),e.jsx(ee,{children:e.jsx(se,{type:"single",onValueChange:o=>a(o===""?void 0:o),defaultValue:String(s),children:e.jsx(te,{className:k("flex flex-col justify-start p-1 gap-3 h-full w-full",c),children:t.map(o=>e.jsx(ae,{className:"px-0 w-full h-30",value:String(o.id),id:String(o.id),children:e.jsx(Me,{...n,entity:o,checked:s===String(o.id)})},String(o.id)))})})})]})},Ge=({fetchEntity:s,columnsFn:t,filteredColumn:a,rowSelection:n,entityKey:i,onCreate:r,onEdit:c,onOpen:l,onDelete:o,sidebarEntityId:u,setSidebarEntityId:x,sidebarEntities:d,sidebarCardProps:T,secondaryEntityKey:H})=>{var I,w;const{t:B}=b(),j=ne({column:a}),g=ie(),h=oe(),R=le(),V=A("md"),{onPaginationChange:$,pageIndex:v,pageSize:N}=re({entityKey:i}),O=[i,u,H,{page:v,size:N},j.columnFilters,{sortBy:(I=h.sorting[0])!=null&&I.id?h.sorting[0].id:"created_at",desc:(w=h.sorting[0])==null?void 0:w.desc},{filters:g.columnsFilter}],{data:p,isFetching:D}=ce({queryFn:s,queryKey:O,initialData:{entities:[],pageCount:1}}),E=t({onEdit:c,onDelete:o,onOpen:l}),f=de({data:p,columns:E,pageSize:N,pageIndex:v,rowSelection:n,visibility:R,sorting:h,onPaginationChange:$}),L=m.useMemo(()=>({entityKey:i,table:f,data:p.entities,primaryFilter:j,filters:g,isLoading:D}),[i,f,p.entities,g,j,D]),M=m.useMemo(()=>({sidebarEntities:d,setSidebarEntityId:x,sidebarEntityId:u,sidebarCardProps:T}),[d,x,u,T]);return{t:B,desktop:V,table:f,entityTableContextValue:L,sidebarEntityTableContextValue:M,columns:E,onCreate:r}};function z({table:s,columns:t,props:a}){return e.jsxs("div",{className:"flex flex-col justify-between size-full",children:[e.jsx(fe,{columns:t,onRowClick:a.onOpen}),e.jsx(Se,{table:s})]})}function Qe(s){const{t}=b(),{desktop:a,table:n,entityTableContextValue:i,sidebarEntityTableContextValue:r,columns:c,onCreate:l}=Ge(s);return e.jsx(ue.Provider,{value:i,children:e.jsx(xe.Provider,{value:r,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-col md:flex-row-reverse items-center py-4 gap-2 w-full",children:[e.jsxs("div",{className:"flex flex-row justify-center items-center w-full",children:[!a&&e.jsx(_e,{buttonChild:e.jsxs(be,{className:"items-center p-1",children:[e.jsx(he,{className:"size-4"})," ",t("inbounds")]})}),e.jsx(me,{table:n}),l&&e.jsx(y,{"aria-label":`create-${s.entityKey}`,onClick:l,children:t("create")})]}),e.jsx(je,{})]}),e.jsx("div",{className:"w-full rounded-md border",children:a?e.jsxs(ge,{direction:"horizontal",children:[e.jsx(P,{minSize:20,maxSize:40,children:e.jsx(F,{})}),e.jsx(pe,{withHandle:a}),e.jsx(P,{children:e.jsx(z,{table:n,columns:c,props:s})})]}):e.jsx(z,{table:n,columns:c,props:s})})]})})})}const Je=s=>[{accessorKey:"remark",header:({column:t})=>e.jsx(S,{title:C.t("name"),column:t})},{accessorKey:"address",header:({column:t})=>e.jsx(S,{title:C.t("address"),column:t})},{accessorKey:"port",header:({column:t})=>e.jsx(S,{title:C.t("port"),column:t})},{id:"actions",cell:({row:t})=>e.jsx($e,{row:t,actions:s,children:e.jsx(Oe,{...s,row:t})})}],Ye=({open:s,onOpenChange:t})=>{const{t:a}=b();return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(ye,{children:[e.jsxs(Te,{children:[e.jsx(ve,{children:a("page.hosts.no-inbound-selection-alert.title")}),e.jsx(Ne,{children:a("page.hosts.no-inbound-selection-alert.desc")})]}),e.jsx(De,{children:e.jsx(Ee,{children:a("close")})})]})})},Ue=({entity:s})=>e.jsx("div",{className:"flex items-center",children:e.jsx(Pe,{className:"font-bold capitalize",children:s.tag})}),We=({entity:s})=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"hstack items-center",children:[e.jsx(Ie,{className:"p-1"})," ",s.node.name]}),e.jsx(we,{children:s.protocol})]}),Xe=()=>{var x;const{data:s}=ze({page:1,size:100}),[t,a]=m.useState(((x=s.entities[0])==null?void 0:x.id)!==void 0?String(s.entities[0].id):void 0),n=ke({from:"/hosts"}),[i,r]=Ae(),c=d=>n({to:"/hosts/$hostId/edit",params:{hostId:String(d.id)}}),l=d=>n({to:"/hosts/$hostId/delete",params:{hostId:String(d.id)}}),o=d=>n({to:"/hosts/$hostId",params:{hostId:String(d.id)}}),u=()=>{t?n({to:"/hosts/$inboundId/create",params:{inboundId:t}}):r(!0)};return e.jsxs("div",{className:"w-full",children:[e.jsx(Ye,{open:i,onOpenChange:r}),e.jsx(Qe,{fetchEntity:Ze,entityKey:"inbounds",secondaryEntityKey:"hosts",sidebarEntities:s.entities,sidebarEntityId:t,columnsFn:Je,filteredColumn:"remark",setSidebarEntityId:a,onCreate:u,onOpen:o,onEdit:c,onDelete:l,sidebarCardProps:{header:Ue,content:We}})]})};async function Ze({queryKey:s}){const t=s[3],a=s[4],n=s[6].filters;return Fe(s[1]!==void 0?`/inbounds/${s[1]}/hosts`:"/inbounds/hosts",{query:{...t,...n,remark:a,descending:s[5].desc,order_by:s[5].sortBy}}).then(i=>({entities:i.items,pageCount:i.pages}))}const Ke=()=>{const{t:s}=b();return e.jsxs(Ve,{title:s("hosts"),children:[e.jsx(Xe,{}),e.jsx(m.Suspense,{fallback:e.jsx(Re,{}),children:e.jsx(Be,{})})]})},as=He("/_dashboard/hosts")({component:()=>e.jsx(Le,{children:e.jsx(Ke,{})})});export{Ke as HostsPage,as as Route};
