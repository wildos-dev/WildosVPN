import{a8 as x,I as d,J as e,a9 as C,aa as _,ab as T,ac as f,ad as N,r as p,ae as k,af as y,ag as F,ah as S,ai as m,aj as D,ak as O,al as I,am as U,an as w,ao as E,ap as z,aq as P,ar as K,as as L,at as u,au as l,av as A,aw as M,ax as B,ay as H,az as V,aA as $,aB as q,aC as Q,aD as R,U as G,aE as J,aF as X,aG as Z,aH as W,aI as Y,a7 as ee,aJ as se,aK as te}from"./index-DPGZIZMG.js";import{P as ae}from"./index-DWVRUEcY.js";import{N as re,D as ne}from"./actions-cell-DuCDMYMS.js";import{E as ie}from"./entity-table-Z-Amuqnp.js";/**
 * @license lucide-react v0.359.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=x("FilterX",[["path",{d:"M13.013 3H2l8 9.46V19l4 2v-8.54l.9-1.055",key:"1fi1da"}],["path",{d:"m22 3-5 5",key:"12jva0"}],["path",{d:"m17 3 5 5",key:"k36vhe"}]]);/**
 * @license lucide-react v0.359.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=x("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.359.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=x("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ue=({user:t})=>{let s,a;const o=he(t),{t:i}=d();return t.online_at===null?(s="text-yellow-500",a=i("not_connected")):o?(s="text-green-500",a=i("online")):(s="text-red-500",a=i("offline")),e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(T,{className:f("w-5 h-5",s)})}),e.jsx(N,{children:a})]})};function de({title:t,column:s,options:a}){const[o,i]=p.useState(!1),c=k("md"),[n,r]=p.useState(null),{filters:g,table:{setPageIndex:j}}=y();function b(){g.setColumnsFilter({...g.columnsFilter,[s.id]:void 0}),r(null),j(1)}return c?e.jsxs(F,{open:o,onOpenChange:i,children:[e.jsx(S,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"data-[state=open]:bg-accent justify-start",children:[n||t,e.jsx(m,{variant:"ghost",onMouseDown:b,size:"sm",className:f("p-2 ml-1",{"hover:text-destructive/90":!!n,"hover:text-primary/90":!n}),children:n?e.jsx(oe,{className:"size-4"}):e.jsx(le,{className:"size-4"})})]})}),e.jsx(D,{className:"w-[200px] p-0",align:"start",children:e.jsx(h,{setOpen:i,columnName:s.id,setSelectedOption:v=>{r(v),j(1)},options:a})})]}):e.jsxs(O,{open:o,onOpenChange:i,children:[e.jsx(I,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"data-[state=open]:bg-accent w-fit justify-start",children:n||t})}),e.jsx(U,{children:e.jsx("div",{className:"mt-4 border-t",children:e.jsx(h,{setOpen:i,columnName:s.id,setSelectedOption:r,options:a})})})]})}function h({setOpen:t,setSelectedOption:s,options:a,columnName:o}){const{filters:i}=y(),{t:c}=d();return e.jsxs(w,{children:[e.jsx(E,{className:"border-0 focus:ring-0",placeholder:"Filters..."}),e.jsxs(z,{children:[e.jsx(P,{children:c("table.no-result-found")}),e.jsx(K,{children:a.map(n=>e.jsx(L,{value:n,onSelect:r=>{s(r),t(!1),i.setColumnsFilter({...i.columnsFilter,[o]:r})},children:n},n))})]})]})}const me=t=>[{accessorKey:"username",header:({column:s})=>e.jsx(u,{title:l.t("username"),column:s}),cell:({row:s})=>e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx(ue,{user:s.original})," ",s.original.username]})},{accessorKey:"activated",enableSorting:!1,header:({column:s})=>e.jsx(u,{title:l.t("activated"),column:s}),cell:({row:s})=>e.jsx(A,{user:s.original})},{accessorKey:"owner_username",enableSorting:!1,sudoVisibleOnly:!0,header:({column:s})=>e.jsx(pe,{column:s})},{accessorKey:"used_traffic",header:({column:s})=>e.jsx(u,{title:l.t("page.users.used_traffic"),column:s}),cell:({row:s})=>e.jsx(M,{user:s.original})},{accessorKey:"expire_strategy",header:({column:s})=>e.jsx(u,{title:l.t("page.users.expire_method"),column:s}),cell:({row:s})=>e.jsx(ge,{user:s.original}),enableSorting:!1},{accessorKey:"expire_date",header:({column:s})=>e.jsx(u,{title:l.t("page.users.expire_date"),column:s}),cell:({row:s})=>e.jsx(B,{user:s.original})},{id:"actions",cell:({row:s})=>e.jsxs(re,{row:s,actions:t,children:[e.jsx(H,{text:$(s.original.subscription_url),successMessage:l.t("page.users.settings.subscription_link.copied"),copyIcon:ce,className:V({variant:"secondary",className:"size-8"}),tooltipMsg:l.t("page.users.settings.subscription_link.copy")}),e.jsx(ne,{...t,row:s})]})}];function pe({column:t}){const{data:s}=q({page:1,size:100,filters:{}});return e.jsx(de,{title:l.t("owner"),column:t,options:s.entities.map(a=>a.username)})}const xe=()=>{const t=Q({from:"/users"}),{isSudo:s}=R(),a=r=>{t({to:"/users/$userId",params:{userId:r.username}})},c=me({onEdit:r=>{t({to:"/users/$userId/edit",params:{userId:r.username}})},onDelete:r=>{t({to:"/users/$userId/delete",params:{userId:r.username}})},onOpen:a}),n=c.filter(r=>!r.sudoVisibleOnly);return e.jsx(ie,{fetchEntity:J,columns:s()?c:n,primaryFilter:"username",entityKey:G,onCreate:()=>t({to:"/users/create"}),onOpen:a})},ge=({user:t})=>{const{t:s}=d(),a={start_on_first_use:s("page.users.on_first_use"),fixed_date:s("page.users.fixed_date"),never:s("page.users.never")}[t.expire_strategy],o={start_on_first_use:"royal",fixed_date:"warning",never:"disabled"}[t.expire_strategy];return e.jsx(X,{variant:o,children:a})},je=()=>{const{t}=d(),{data:s}=Z({page:1,size:10});return s&&s.pageCount===0&&e.jsx(W,{title:t("page.users.services-alert.title"),desc:e.jsxs(e.Fragment,{children:[t("page.users.services-alert.desc"),e.jsx(Y,{className:"m-1 font-semibold text-secondary-foreground",to:"/services",children:t("page.nodes.certificate-alert.click")})]})})},he=t=>{const s=new Date(t.online_at+"Z");return Math.abs(new Date().getTime()-s.getTime())<3e4},fe=()=>{const{t}=d();return e.jsxs(ae,{title:t("users"),footer:e.jsx(je,{}),children:[e.jsx(xe,{}),e.jsx(p.Suspense,{fallback:e.jsx(te,{}),children:e.jsx(se,{})})]})},_e=ee("/_dashboard/users")({component:()=>e.jsx(fe,{})});export{_e as Route,fe as UsersPage};
